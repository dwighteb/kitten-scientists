name: QA

on:
  pull_request:
  push:

jobs:
  qa:
    name: Run QA
    runs-on: ubuntu-22.04
    permissions:
      contents: read

    steps:
      - name: Checkout
        uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332 # v4

      - name: Validate commit messages
        uses: oliversalzburg/action-commit-validator@3d55a588a712a905f073a6a6b1cdeb7af8a37c41 # v0.0.10
        if: github.event_name == 'pull_request'
        with:
          accept_breaking_changes: false
          accept_emoji: false
          accepted_scopes: |
            bonfire
            religion
            science
            space
            time
            trade
            village
            workshop

            api
            build
            container
            core
            deps
            deps-dev
            filters
            i18n
            schema
            settings
            ui
          accepted_types: |
            chore
            ci
            docs
            feat
            fix
            refactor
            test
          repo_token: ${{ secrets.GITHUB_TOKEN }}

      - name: Select NodeJS version
        uses: actions/setup-node@1e60f620b9541d16bece96c5465dc8ee9832be0b # v4
        env:
          # renovate: datasource=docker depName=node versioning=node
          NODE_VERSION: "20.16.0"
        with:
          node-version: ${{ env.NODE_VERSION }}
      - run: yarn install --immutable

      - run: yarn build:all
      - run: yarn lint:all
      - run: yarn test:all
      - run: yarn kitten-scientists:build
